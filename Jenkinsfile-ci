pipeline{
    agent any
    tools{
        maven 'MAVEN'
        dockerTool 'DOCKER_HOME'
    }

    environment {
        CI = true
        ARTIFACTORY_ACCESS_TOKEN = credentials('az-container-artifactory-token')
    }

    stages{
        stage ("maven build"){
            steps{
                sh 'mvn clean package'
            }
        }

        stage('Upload to Artifactory') {
          rtUpload (
            serverId: 'jfrog-artifactory',
            spec: '''{
                      "files": [
                        {
                          "pattern": "/var/jenkins_home/workspace/ci-maven-artifactory/target/restro.war",
                          "target": "restro-mvn-local/"
                        }
                      ]
            }''',
            failNoOp = true
          )
        }
    }
}
