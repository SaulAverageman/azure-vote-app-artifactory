pipeline{
    agent any
    tools{
        maven 'MAVEN'
    }

    environment {
        CI = true
        ARTIFACTORY_ACCESS_TOKEN = credentials('az-container-artifactory-token')
    }

    stages{
        stage ("maven build"){
            steps{
                sh 'mvn clean package'
            }
        }

    stage('Upload to Artifactory') {
      agent {
        docker {
          image 'releases-docker.jfrog.io/jfrog/jfrog-cli-v2:2.2.0' 
          reuseNode true
        }
      }
      steps {
        sh 'jfrog rt upload --url http://10.0.0.5/artifactory/ --access-token ${ARTIFACTORY_ACCESS_TOKEN} /var/jenkins_home/workspace/ci-maven-artifactory/target/restro.war restro-mvn-local/'
      }
    }
    }
}
