pipeline{
    agent any

    environment {
        CI = true
        ARTIFACTORY_ACCESS_TOKEN = credentials('az-container-artifactory-token')
    }
    
    stages{
        stage('Download from Artifactory') {
          steps{
            sh 'rm -f /var/jenkins_home/workspace/cd-artifactory-azvm/artifacts/restro-built.war'

            rtDownload (
              buildName: 'restro.war',
              buildNumber: '1',
              serverId: 'jfrog-artifactory',
              spec: '''{
                        "files": [
                          {
                            "pattern":"restro-mvn-local/restro.war",
                            "target": "/var/jenkins_home/workspace/cd-artifactory-azvm/artifacts/restro-built.war"
                          }
                        ]
              }'''
            )

            sh 'ls -a /var/jenkins_home/workspace/cd-artifactory-azvm/artifacts/'
        }
    }
  }
}